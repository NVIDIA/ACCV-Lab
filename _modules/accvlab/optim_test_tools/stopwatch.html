

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>accvlab.optim_test_tools.stopwatch &mdash; ACCV-Lab 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=9282052d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ACCV-Lab
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../project_overview/README.html">ACCV-Lab Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides_index.html">Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contained Packages</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../contained_package_docs_mirror/on_demand_video_decoder/docs/index.html">On Demand Video Decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contained_package_docs_mirror/batching_helpers/docs/index.html">Batching Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contained_package_docs_mirror/dali_pipeline_framework/docs/index.html">DALI Pipeline Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contained_package_docs_mirror/draw_heatmap/docs/index.html">Draw Heatmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contained_package_docs_mirror/optim_test_tools/docs/index.html">Optimization Testing Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ACCV-Lab</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">accvlab.optim_test_tools.stopwatch</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for accvlab.optim_test_tools.stopwatch</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) 2025, NVIDIA CORPORATION &amp; AFFILIATES. All rights reserved.</span>
<span class="c1">#</span>
<span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="c1"># You may obtain a copy of the License at</span>
<span class="c1">#</span>
<span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c1">#</span>
<span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="c1"># See the License for the specific language governing permissions and</span>
<span class="c1"># limitations under the License.</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Optional</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">.singleton_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">SingletonBase</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">singleton_base</span><span class="w"> </span><span class="kn">import</span> <span class="n">SingletonBase</span>


<div class="viewcode-block" id="Stopwatch">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Stopwatch</span><span class="p">(</span><span class="n">SingletonBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stopwatch for performing runtime evaluations.</span>

<span class="sd">    This is a singleton class for performing runtime measurements and obtaining the total as well as average</span>
<span class="sd">    run-time for the measurements</span>

<span class="sd">      1. per measurement.</span>
<span class="sd">      2. per (training) iteration, where a single measurement can be performed multiple times, or only in some</span>
<span class="sd">         iterations.</span>

<span class="sd">    A warm-up phase can be defined when configuring the stopwatch. During the warm-up phase, no measurements</span>
<span class="sd">    are performed.</span>

<span class="sd">    Multiple measurements can be performed, and are distinguished by name. The end of a (training) iteration is</span>
<span class="sd">    indicated explicitly (by calling the method :meth:`finish_iter`). This is done to automatically start</span>
<span class="sd">    measurements after the warm-up phase is finished, to average the measurements over the iterations, and</span>
<span class="sd">    to print the measurements in certain intervals.</span>

<span class="sd">    The CPU usage can be measured for one &quot;type&quot; of measurement (i.e. one measurement name). This is done by</span>
<span class="sd">    calling the :meth:`set_cpu_usage_meas_name` before the first measurement with the corresponding name is</span>
<span class="sd">    started. The CPU usage is then measured whenever the measurement is running and the average CPU usage is</span>
<span class="sd">    printed together with the other measurements.</span>

<span class="sd">    One-time measurements can be performed at any point in the code (see :meth:`start_one_time_measurement`,</span>
<span class="sd">    :meth:`end_one_time_measurement`). They are not affected by the warm-up phase and are reported as such</span>
<span class="sd">    (i.e. in own section and without averages etc.). Each one-time measurement (i.e. measurement with a given</span>
<span class="sd">    name) can be performed only once.</span>

<span class="sd">    Warning:</span>

<span class="sd">        The CPU usage is measured using :func:`psutil.cpu_percent`. To ensure that the interval for which the</span>
<span class="sd">        CPU usage is measured is correct, the function :func:`psutil.cpu_percent` must not be called outside</span>
<span class="sd">        of the stopwatch during the measurement.</span>

<span class="sd">    The stopwatch must be first enabled before any measurements are performed. If not enabled, calls to any</span>
<span class="sd">    methods have minimal overhead. To ensure this, the methods are empty in disabled state and replaced with</span>
<span class="sd">    methods implementing the functionality when enabled. This means that the runtime overhead for using the</span>
<span class="sd">    stopwatch is negligible when it is not enabled. The enabling can be done from any part of the code (as</span>
<span class="sd">    this is a singleton).</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">_TimeAccumulator</span><span class="p">:</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_accum_time</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_meas</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">,</span> <span class="s2">&quot;Trying to start a time emasurement which is already running&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">now</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">):</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">,</span> <span class="s2">&quot;Trying to end a time measurement which was not started&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_accum_time</span> <span class="o">+=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_num_meas</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_running</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_accum_time</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">,</span> <span class="s2">&quot;Calling `get_accum_time()` not supported while measurement is running&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accum_time</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_num_meas</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span><span class="p">,</span> <span class="s2">&quot;Calling `get_num_meas()` not supported while measurement is running&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_meas</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">is_running</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_running</span>

    <span class="k">class</span><span class="w"> </span><span class="nc">_TimeAndCPUUsageAccumulator</span><span class="p">(</span><span class="n">_TimeAccumulator</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">psutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">cpu_percent</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_percent</span> <span class="o">=</span> <span class="n">cpu_percent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_times_time_accum</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_start_time</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_start_time</span> <span class="o">=</span> <span class="n">now</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">now</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
            <span class="n">cpu_interval</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_start_time</span>
            <span class="n">cpu_usage</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_percent</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_times_time_accum</span> <span class="o">+=</span> <span class="n">cpu_interval</span> <span class="o">*</span> <span class="n">cpu_usage</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">get_mean_cpu_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_times_time_accum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_accum_time</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">res</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        Note:</span>
<span class="sd">            When obtaining an object using (``Stopwatch()``) the singleton is returned if already</span>
<span class="sd">            created.</span>

<span class="sd">            If parameters are provided when calling ``Stopwatch()``, this will enable the stopwatch</span>
<span class="sd">            (equivalent to calling :meth:`enable`). Note that enabling can only be done once, and will</span>
<span class="sd">            lead to an error if attempted a second time.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_warmup_iters: The number of warmup iterations to be performed before the runtime</span>
<span class="sd">                measurement is started.</span>
<span class="sd">            print_every_n_iters: Once in how many iterations to print the measured runtime. If</span>
<span class="sd">                ``None``, the runtime is not printed automatically (but can still be printed manually</span>
<span class="sd">                by calling :meth:`print_eval_times`).</span>
<span class="sd">            do_cuda_sync: Whether to synchronize the CUDA device every time a measurement is started</span>
<span class="sd">                or stopped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;_initialized&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_SET_DOCSTRINGS_OF_ENABLED_METHOD_VARIANTS</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Stopwatch.enable">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.enable">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_warmup_iters</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">print_every_n_iters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">do_cuda_sync</span><span class="p">:</span> <span class="nb">bool</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Enable the stopwatch</span>

<span class="sd">        This method can be called only once and enables the Stopwatch singleton.</span>
<span class="sd">        Any measurements started or performed before calling this method are ignored.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_warmup_iters: The number of warmup iterations to be performed before the runtime measurement is started</span>
<span class="sd">            print_every_n_iters: Once in how many iterations to print the measured runtime. If ``None``, the runtime is not</span>
<span class="sd">                printed automatically (but can be still printed manually by calling :meth:`print_eval_times`).</span>
<span class="sd">            do_cuda_sync: Whether to synchronize CUDA device every time a measurement is started or stopped.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span><span class="p">,</span> <span class="p">(</span>
            <span class="s2">&quot;Stopwatch singleton can be enabled only once (either by passing arguments when it &quot;</span>
            <span class="s2">&quot;is obtained, or by calling :meth:`enable` directly)&quot;</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span> <span class="o">=</span> <span class="n">num_warmup_iters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_print_every_n_iters</span> <span class="o">=</span> <span class="n">print_every_n_iters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_times</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_do_cuda_sync</span> <span class="o">=</span> <span class="n">do_cuda_sync</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
        <span class="c1"># Warmup is only finished already if there is no warmup (i.e. 0 warmup iterations)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span> <span class="o">=</span> <span class="n">num_warmup_iters</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_cuda_sync</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_torch</span> <span class="o">=</span> <span class="n">torch</span>

        <span class="c1"># Name of the measurement for which CPU usage is measured.</span>
        <span class="c1"># If None, no CPU usage measurements are performed.</span>
        <span class="c1"># This is set by the method `set_cpu_usage_meas_name`.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set the methods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_cpu_usage_meas_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_cpu_usage_meas_name_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_meas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_meas_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_meas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_meas_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_one_time_measurement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_start_one_time_measurement_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_one_time_measurement</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_one_time_measurement_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_eval_times</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_eval_times_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">finish_iter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_finish_iter_enabled</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_num_nonwarmup_iters_measured</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_num_nonwarmup_iters_measured_enabled</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">is_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Whether the stopwatch is enabled&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_enabled</span>

<div class="viewcode-block" id="Stopwatch.print_eval_times">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.print_eval_times">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_eval_times</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Print the evaluation times&quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.set_cpu_usage_meas_name">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.set_cpu_usage_meas_name">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">set_cpu_usage_meas_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the name of the CPU usage measurement</span>

<span class="sd">        This method must be called before the first measurement with the corresponding name is started.</span>

<span class="sd">        Important:</span>
<span class="sd">            If the CPU usage measurement is already set, it cannot be changed. Calling this method with</span>
<span class="sd">            a different name will raise an error.</span>

<span class="sd">            Calling this method with the same name as the current CPU usage measurement name is allowed</span>
<span class="sd">            and will have no effect. This is useful to set the CPU usage name right before starting</span>
<span class="sd">            the first measurement with the corresponding name, even if the corresponding code</span>
<span class="sd">            region is called iteratively.</span>

<span class="sd">        Warning:</span>
<span class="sd">            The CPU usage is measured using :func:`psutil.cpu_percent`. To ensure that the interval for which the CPU usage is measured</span>
<span class="sd">            is correct, the function :func:`psutil.cpu_percent` must not be called outside of the stopwatch during the measurement.</span>


<span class="sd">        Args:</span>
<span class="sd">            name: Name of the measurement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.start_meas">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.start_meas">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_meas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start a measurement with given name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name for the measurement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.end_meas">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.end_meas">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">end_meas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;End a measurement with given name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the measurements</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.start_one_time_measurement">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.start_one_time_measurement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">start_one_time_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Start a one-time measurement with given name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the measurement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.end_one_time_measurement">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.end_one_time_measurement">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">end_one_time_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;End a one-time measurement with given name.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Name of the measurement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.finish_iter">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.finish_iter">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">finish_iter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Finish the current iteration.&quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">pass</span></div>


<div class="viewcode-block" id="Stopwatch.get_num_nonwarmup_iters_measured">
<a class="viewcode-back" href="../../../contained_package_docs_mirror/optim_test_tools/docs/api.html#accvlab.optim_test_tools.Stopwatch.get_num_nonwarmup_iters_measured">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_num_nonwarmup_iters_measured</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the number of non-warmup iterations performed.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Number of measured non-warmup iterations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Empty method to minimize overhead if not enabled. Will be replaced when enabling.</span>
        <span class="k">return</span> <span class="mi">0</span></div>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_SET_DOCSTRINGS_OF_ENABLED_METHOD_VARIANTS</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the docstrings of the enabled method variants.</span>

<span class="sd">        This is done to ensure that the correct docstring is present in the methods</span>
<span class="sd">        once the Stopwatch is enabled, and the original (disabled) methods are replaced by the</span>
<span class="sd">        enabled variants.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_print_eval_times_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">print_eval_times</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_set_cpu_usage_meas_name_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">set_cpu_usage_meas_name</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_start_meas_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">start_meas</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_end_meas_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">end_meas</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_start_one_time_measurement_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">start_one_time_measurement</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_end_one_time_measurement_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">end_one_time_measurement</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_finish_iter_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">finish_iter</span><span class="o">.</span><span class="vm">__doc__</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_get_num_nonwarmup_iters_measured_enabled</span><span class="o">.</span><span class="vm">__doc__</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_num_nonwarmup_iters_measured</span><span class="o">.</span><span class="vm">__doc__</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_print_eval_times_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">25</span> <span class="o">+</span> <span class="s2">&quot; Stopwatch &quot;</span> <span class="o">+</span> <span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;~&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;warmup not finished (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span><span class="si">}</span><span class="s2"> out of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span><span class="si">}</span><span class="s2"> warmup iterations finished)&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;~&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;warmup finished (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span><span class="si">}</span><span class="s2"> iterations), but no iterations were performed after that&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_measured_iters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;~&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Num. measured iterations: </span><span class="si">{</span><span class="n">num_measured_iters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Mean time per iteration</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;. &quot;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average runtime per iteration:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">time_name</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  `</span><span class="si">{</span><span class="n">time_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">get_accum_time</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">num_measured_iters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Mean time per measured interval</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;. &quot;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average runtime per measured interval:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">time_name</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  `</span><span class="si">{</span><span class="n">time_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">get_accum_time</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">time</span><span class="o">.</span><span class="n">get_num_meas</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Total runtime</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;. &quot;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total runtime:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">time_name</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  `</span><span class="si">{</span><span class="n">time_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">get_accum_time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Mean CPU usage</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;. &quot;</span> <span class="o">*</span> <span class="mi">25</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Mean CPU usage during `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span><span class="p">]</span><span class="o">.</span><span class="n">get_mean_cpu_usage</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;~&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;One-time measurements:&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">time_name</span><span class="p">,</span> <span class="n">time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  `</span><span class="si">{</span><span class="n">time_name</span><span class="si">}</span><span class="s2">`: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">get_accum_time</span><span class="p">()</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">time</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;running&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;~&quot;</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">*</span> <span class="mi">61</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_set_cpu_usage_meas_name_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;CPU usage measurement name `</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span><span class="si">}</span><span class="s2">` already set. Cannot set it to `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">`.&quot;</span>
                <span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Measurement name `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` already present. A measurement must be selected for CPU usage measurements before being performed for the first time.&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cpu_usage_meas_name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TimeAndCPUUsageAccumulator</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_start_meas_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TimeAccumulator</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_cuda_sync</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_end_meas_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Entry `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` not present, cannot end measurment&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_do_cuda_sync</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_start_one_time_measurement_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;One-time measurement `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` already present, cannot start it again&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TimeAccumulator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_end_one_time_measurement_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span>
        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;One-time measurement `</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">` not present, cannot end it&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_one_time_measurements</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">end</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_finish_iter_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_times</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">assert</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">is_running</span><span class="p">()</span>
            <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;At the end of an iteration, all started measurements need to be ended. Measurement </span><span class="se">\</span>
<span class="s2">                for &#39;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">&#39; is started but not ended.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">num_nonwarmup_iters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span>
            <span class="k">if</span> <span class="n">num_nonwarmup_iters</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_print_every_n_iters</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">num_nonwarmup_iters</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">_print_every_n_iters</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">print_eval_times</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_num_nonwarmup_iters_measured_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TEMPORARY DOCSTRING</span>
<span class="sd">        This is the enabled variant of the corresponding method (same name without leading `_` and training `_enabled`).</span>
<span class="sd">        This docstring will be replaced with the docstring of the corresponding method when an instance is requested</span>
<span class="sd">        for the first time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_warmup_finished</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_iters_finished</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_warmup_iters</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">0</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="c1"># --------------------------- Main Script ---------------------------</span>
    <span class="n">stopwatch</span> <span class="o">=</span> <span class="n">Stopwatch</span><span class="p">()</span>
    <span class="c1"># To activate the stop watch, it needs to be enabled.</span>
    <span class="c1"># If the following step is omitted, calls to method of the stopwatch will have no effect</span>
    <span class="c1"># (and `get_num_nonwarmup_iters_measured()`) will always return `0``.</span>
    <span class="c1"># Try commenting out the following line:</span>
    <span class="n">stopwatch</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span><span class="n">num_warmup_iters</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">print_every_n_iters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">do_cuda_sync</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># Note that if the stopwatch is not enabled, calling its methods has minimal overhead</span>
    <span class="c1"># (call to an empty method).</span>
    <span class="c1"># -------------------------------------------------------------------</span>

    <span class="c1"># ---------------------------- Code Part I ----------------------------</span>

    <span class="n">stopwatch</span><span class="o">.</span><span class="n">set_cpu_usage_meas_name</span><span class="p">(</span><span class="s2">&quot;meas1&quot;</span><span class="p">)</span>

    <span class="c1"># Note that if a code part (see below) is used in isolation, the stopwatch will be disabled and</span>
    <span class="c1"># no error will occur. The overhead for the stopwatch is minimal in this case (call to an empty function).</span>

    <span class="n">stopwatch</span> <span class="o">=</span> <span class="n">Stopwatch</span><span class="p">()</span>
    <span class="n">stopwatch</span><span class="o">.</span><span class="n">start_one_time_measurement</span><span class="p">(</span><span class="s2">&quot;complete_run&quot;</span><span class="p">)</span>

    <span class="n">stopwatch</span><span class="o">.</span><span class="n">start_one_time_measurement</span><span class="p">(</span><span class="s2">&quot;preparation&quot;</span><span class="p">)</span>
    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">stopwatch</span><span class="o">.</span><span class="n">end_one_time_measurement</span><span class="p">(</span><span class="s2">&quot;preparation&quot;</span><span class="p">)</span>

    <span class="n">num_iters</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iters</span><span class="p">):</span>
        <span class="c1"># -------------------------- Code Part II --------------------------</span>
        <span class="c1"># This will not create a new instance, but re-use the instance created above.</span>
        <span class="c1"># No configuration should be done (passing parameters will raise error).</span>
        <span class="n">stopwatch</span> <span class="o">=</span> <span class="n">Stopwatch</span><span class="p">()</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">start_meas</span><span class="p">(</span><span class="s2">&quot;meas1&quot;</span><span class="p">)</span>
        <span class="c1"># time.sleep(0.16)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000000</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.3</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="c1"># ... continue and at some point call code part II ...</span>
        <span class="c1"># ------------------------------------------------------------------</span>

        <span class="c1"># -------------------------- Code Part II --------------------------</span>
        <span class="n">stopwatch</span> <span class="o">=</span> <span class="n">Stopwatch</span><span class="p">()</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">start_meas</span><span class="p">(</span><span class="s2">&quot;meas2&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">end_meas</span><span class="p">(</span><span class="s2">&quot;meas2&quot;</span><span class="p">)</span>
        <span class="c1"># ------------------------------------------------------------------</span>

        <span class="c1"># ----------------------- Code Part II (back) ----------------------</span>
        <span class="c1"># ... back from the call to code part II ...</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">end_meas</span><span class="p">(</span><span class="s2">&quot;meas1&quot;</span><span class="p">)</span>
        <span class="c1"># ------------------------------------------------------------------</span>

        <span class="c1"># -------------------------- Code Part IV --------------------------</span>
        <span class="n">stopwatch</span> <span class="o">=</span> <span class="n">Stopwatch</span><span class="p">()</span>
        <span class="c1"># Measurements can be performed in only some of the iterations</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">stopwatch</span><span class="o">.</span><span class="n">start_meas</span><span class="p">(</span><span class="s2">&quot;meas3&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
            <span class="n">stopwatch</span><span class="o">.</span><span class="n">end_meas</span><span class="p">(</span><span class="s2">&quot;meas3&quot;</span><span class="p">)</span>
        <span class="c1"># We can perform a measurement for the same entry multiple times in a</span>
        <span class="c1"># single iteration. This can be in the same or different code parts.</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">start_meas</span><span class="p">(</span><span class="s2">&quot;meas2&quot;</span><span class="p">)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">end_meas</span><span class="p">(</span><span class="s2">&quot;meas2&quot;</span><span class="p">)</span>
        <span class="c1"># ------------------------------------------------------------------</span>

        <span class="c1"># -------------------------- Code Part V ---------------------------</span>
        <span class="c1"># Finish the iteration</span>
        <span class="n">stopwatch</span> <span class="o">=</span> <span class="n">Stopwatch</span><span class="p">()</span>
        <span class="n">stopwatch</span><span class="o">.</span><span class="n">finish_iter</span><span class="p">()</span>
        <span class="c1"># ------------------------------------------------------------------</span>

    <span class="c1"># ---------------------------- Code Part VI ----------------------------</span>
    <span class="c1"># End the one-time measurement</span>
    <span class="n">stopwatch</span><span class="o">.</span><span class="n">end_one_time_measurement</span><span class="p">(</span><span class="s2">&quot;complete_run&quot;</span><span class="p">)</span>
    <span class="c1"># Print the final result</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Final measurement:&quot;</span><span class="p">)</span>
    <span class="n">stopwatch</span><span class="o">.</span><span class="n">print_eval_times</span><span class="p">()</span>
    <span class="c1"># ----------------------------------------------------------------------</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>