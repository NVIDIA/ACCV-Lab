

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Evaluation &mdash; ACCV-Lab 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css?v=9282052d" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="DALI Pipeline Framework" href="../../dali_pipeline_framework/docs/index.html" />
    <link rel="prev" title="Example" href="example.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            ACCV-Lab
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../project_overview/README.html">ACCV-Lab Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../guides_index.html">Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contained Packages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../on_demand_video_decoder/docs/index.html">On Demand Video Decoder</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Batching Helpers</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="api.html">API Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html">Example</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Evaluation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#experiment-setup">Experiment Setup</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hardware-setup">Hardware Setup</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#results">Results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../dali_pipeline_framework/docs/index.html">DALI Pipeline Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../draw_heatmap/docs/index.html">Draw Heatmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../optim_test_tools/docs/index.html">Optimization Testing Tools</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ACCV-Lab</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Batching Helpers</a></li>
      <li class="breadcrumb-item active">Evaluation</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/contained_package_docs_mirror/batching_helpers/docs/evaluation.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="evaluation">
<h1>Evaluation<a class="headerlink" href="#evaluation" title="Link to this heading"></a></h1>
<p>This page summarizes the performance impact of batching the loss computation using
<code class="docutils literal notranslate"><span class="pre">accvlab.batching_helpers</span></code> in a StreamPETR training setup.</p>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Link to this heading"></a></h2>
<section id="experiment-setup">
<h3>Experiment Setup<a class="headerlink" href="#experiment-setup" title="Link to this heading"></a></h3>
<p>For this evaluation, the training is performed for the NuScenes mini dataset, using the StreamPETR model.
The adaptations to the <a class="reference external" href="https://github.com/exiawsh/StreamPETR">original StreamPETR implementation</a>
are as follows:</p>
<p class="rubric">StreamPETR – Optimization Overview</p>
<ul class="simple">
<li><p><strong>HungarianAssigner3D &amp; HungarianAssigner2D</strong>: Original matchers operate on a per‑sample basis.</p>
<ul>
<li><p>Cost matrix computation (pre‑requisite for actual matching) → <strong>Optimized</strong> (following the approach outlined in the <a class="reference internal" href="example.html"><span class="doc">Example</span></a>)</p></li>
<li><p>Matching itself (SciPy implementation on the CPU).</p></li>
<li><p><cite>HungarianAssigner3D</cite>: <cite>nan_to_num()</cite> was a bottleneck; moved to GPU → Changed in both reference &amp; optimized.</p></li>
</ul>
</li>
<li><p><strong>StreamPETR Head</strong></p>
<ul>
<li><p>Loss computation is batched over samples → <strong>Optimized</strong>.</p></li>
<li><p>Loss computation is also batched over the decoder layers → <strong>Optimized</strong> (using multiple batch dimensions).</p></li>
<li><p>Can use a batched assigner → <strong>Optimized</strong>.</p></li>
</ul>
</li>
<li><p><strong>Focal Head</strong></p>
<ul>
<li><p>Loss computation is already batched over samples &amp; camera images</p></li>
<li><p>Can use a batched assigner → <strong>Optimized</strong>.</p></li>
<li><p>Added use of the custom Gaussian heatmap generator → Changed in both reference &amp; optimized.</p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Some of the changes/optimizations are done in both the reference and optimized implementation (indicated in
the overview above). These changes are not specific to the batching optimization, and are therefore
applicable to both implementations. Applying them in both ensures a fair comparison, with the obtained
speedup reflecting the effect of the batching optimizations.</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>For a general overview on how to use the batching helpers to optimize the loss computation, please refer to
the <a class="reference internal" href="example.html"><span class="doc">Example</span></a>.</p>
</div>
<p>The evaluation is performed for a <strong>batch size of 8</strong> (in contrast to the original configuration of 2) to
obtain a realistic setup and highlight the performance impact of the batching in this case.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We are planning to add a demo for the Batching Helpers package in the future, including the implementation
of the experiments performed in this evaluation.</p>
</div>
</section>
<section id="hardware-setup">
<h3>Hardware Setup<a class="headerlink" href="#hardware-setup" title="Link to this heading"></a></h3>
<table class="docutils align-default" id="id1">
<caption><span class="caption-text">System Configuration</span><a class="headerlink" href="#id1" title="Link to this table"></a></caption>
<thead>
<tr class="row-odd"><th class="head"><p>GPU</p></th>
<th class="head"><p>CPU</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>NVIDIA A100-SXM4-80GB</p></td>
<td><p>2x AMD EPYC 7742 64-core Processors</p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Link to this heading"></a></h2>
<p>In the following table, the runtime breakdown of the training iteration is shown.
Note that the grayed out cells do not contain any optimized code. While theoretically, the <code class="docutils literal notranslate"><span class="pre">Optimization</span></code>
step contains changes (due to the deifferent implementation of the loss, leading to different steps
in the packward propagation), the resulting runtime differences in this step are negligible.
The <code class="docutils literal notranslate"><span class="pre">Remaining</span></code> columns in the table show the runtime of the parts of the implementation for
which the runtime is not measured directly. For the <code class="docutils literal notranslate"><span class="pre">Forward</span></code> pass, this mostly corresponds to the forward
pass through the network itself (as opposed to the loss computation). For the <code class="docutils literal notranslate"><span class="pre">Training</span> <span class="pre">Iteration</span></code>, this
may correspond to additional overhead such as e.g. obtaining/waiting for the next batch of data.</p>
<style>
  /* Local styles for the results table; kept scoped to this page */
  table.bh-table {
    border-collapse: collapse;
    margin: 8px auto 16px auto;
    font-size: 0.95rem;
    min-width: 640px;
  }
  table.bh-table th,
  table.bh-table td {
    border: 1px solid #b7c4bb; /* light grey-green grid */
    padding: 6px 10px;
    text-align: center;
    vertical-align: middle;
    white-space: nowrap;
  }
  /* Dark green header */
  table.bh-table .bh-top {
    background: #11795b;
    color: #ffffff;
    font-weight: 700;
  }
  /* Visually remove a cell while keeping column structure */
  table.bh-table .bh-ghost {
    visibility: hidden;
    border: none !important;
    padding: 0 !important;
  }
  /* Layer color pairs - more distinct */
  table.bh-table .bh-pairA-title { background: #cfeadf; font-weight: 700; }
  table.bh-table .bh-pairA-value { background: #e7f6f1; }
  table.bh-table .bh-pairB-title { background: #e6f2d9; font-weight: 700; }
  table.bh-table .bh-pairB-value { background: #f4faea; }
  /* Neutral (no optimization) pair */
  table.bh-table .bh-gray-title { background: #e9ecef; color: #2f3b3a; font-weight: 700; }
  table.bh-table .bh-gray-value { background: #f6f7f9; color: #2f3b3a; }
</style>

<table class="bh-table">
  <tbody>
    <tr>
      <th colspan="5" class="bh-top">Runtime Baseline → Runtime Optimized [ms] (Speedup ×-fold)</th>
    </tr>
    <tr>
      <th colspan="5" class="bh-pairA-title">Training Iteration</th>
    </tr>
    <tr>
      <td colspan="5" class="bh-pairA-value">760 → 615 (× 1.24)</td>
    </tr>
    <tr>
      <th colspan="3" class="bh-pairB-title">Forward (including Loss)</th>
      <th class="bh-gray-title">Optimization</th>
      <th class="bh-gray-title">Remaining</th>
    </tr>
    <tr>
      <td colspan="3" class="bh-pairB-value">363 → 221 (× 1.64)</td>
      <td class="bh-gray-value">318 → 314</td>
      <td class="bh-gray-value">79 → 80</td>
    </tr>
    <tr>
      <th class="bh-gray-title">Remaining</th>
      <th colspan="2" class="bh-pairA-title">Loss</th>
      <td class="bh-ghost"></td>
      <td class="bh-ghost"></td>
    </tr>
    <tr>
      <td class="bh-gray-value">180 → 180</td>
      <td colspan="2" class="bh-pairA-value">183 → 41 (× 4.46)</td>
      <td class="bh-ghost"></td>
      <td class="bh-ghost"></td>
    </tr>
    <tr>
      <td class="bh-ghost"></td>
      <th class="bh-pairB-title">StreamPETR Head</th>
      <th class="bh-pairB-title">Focal Head</th>
      <td class="bh-ghost"></td>
      <td class="bh-ghost"></td>
    </tr>
    <tr>
      <td class="bh-ghost"></td>
      <td class="bh-pairB-value">82 → 25 (× 3.28)</td>
      <td class="bh-pairB-value">100 → 16 (× 6.25)</td>
      <td class="bh-ghost"></td>
      <td class="bh-ghost"></td>
    </tr>
  </tbody>
</table><p>The batching of the loss computation leads to a speedup of <strong>× 4.46</strong> for the loss computation itself, with
different speedups achieved for the different types of loss. The loss optimization translates
to an overall speedup of <strong>× 1.64</strong> for the forward pass and <strong>× 1.24</strong> for the training iteration. Note that
the expected speedup strongly depends on the used batch size.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example.html" class="btn btn-neutral float-left" title="Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../dali_pipeline_framework/docs/index.html" class="btn btn-neutral float-right" title="DALI Pipeline Framework" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>