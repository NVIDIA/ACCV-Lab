

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NVTX Range Wrapper Example &mdash; ACCV-Lab 0.1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/custom.css?v=9282052d" />

  
      <script src="../../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../../_static/documentation_options.js?v=01f34227"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="next" title="Tensor Dumper – Comparison Example" href="tensor_dumper_comparison.html" />
    <link rel="prev" title="Stopwatch Example" href="stopwatch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html" class="icon icon-home">
            ACCV-Lab
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">General Info</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../project_overview/README.html">ACCV-Lab Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../guides_index.html">Guides</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contained Packages</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../on_demand_video_decoder/docs/index.html">On Demand Video Decoder</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../batching_helpers/docs/index.html">Batching Helpers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dali_pipeline_framework/docs/index.html">DALI Pipeline Framework</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../draw_heatmap/docs/index.html">Draw Heatmap</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Optimization Testing Tools</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html">API Reference</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../examples.html">Examples</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="stopwatch.html">Stopwatch Example</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">NVTX Range Wrapper Example</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l4"><a class="reference internal" href="#related-examples">Related examples</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tensor_dumper_comparison.html">Tensor Dumper – Comparison Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="tensor_dumper_dumping.html">Tensor Dumper – Extended Dumping Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">ACCV-Lab</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Optimization Testing Tools</a></li>
          <li class="breadcrumb-item"><a href="../examples.html">Examples</a></li>
      <li class="breadcrumb-item active">NVTX Range Wrapper Example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/contained_package_docs_mirror/optim_test_tools/docs/examples/nvtx_range_wrapper.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="nvtx-range-wrapper-example">
<h1>NVTX Range Wrapper Example<a class="headerlink" href="#nvtx-range-wrapper-example" title="Link to this heading"></a></h1>
<p>The NVTX range wrapper helps annotate code with NVTX ranges to profile code with Nsight Systems.
It follows the same singleton pattern as the stopwatch (see <a class="reference internal" href="stopwatch.html"><span class="doc">Stopwatch Example</span></a>): enable once, then push/pop
ranges from any part of your code.</p>
<dl class="simple">
<dt>Compared to using nvtx ranges directly, it offers the following advantages:</dt><dd><ul class="simple">
<li><p>It is possible to centrally configure whether CUDA synchronization is performed when pushing/popping a
range. While the ranges themselves have already minimal overhead if there is no profiling, the
synchronization adds an additional overhead, and otherwise needs to be handled manually.</p></li>
<li><p>It is possible to check for range push/pop mismatches (only use for debugging purposes and leave disabled
otherwise, as it has an overhead). It can be very handy to check for unexpected range pops for some key
ranges, as manual search for mismatches can be tedious for large codebases.</p></li>
</ul>
</dd>
</dl>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>The code of this example can be found in the repository under
<code class="docutils literal notranslate"><span class="pre">packages/optim_test_tools/examples/nvtx_range_wrapper_example.py</span></code>.</p>
</div>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Singleton: <code class="docutils literal notranslate"><span class="pre">NVTXRangeWrapper()</span></code> returns the global instance.</p></li>
<li><p>Call <code class="docutils literal notranslate"><span class="pre">enable(...)</span></code> once to activate; otherwise calls are no-ops with minimal overhead.</p></li>
<li><p>Push/pop named ranges; optionally verify that the popped name matches expectations.</p></li>
</ul>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading"></a></h2>
<p>Please see the notes in the code for more details.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">packages/optim_test_tools/examples/nvtx_range_wrapper_example.py</span><a class="headerlink" href="#id1" title="Link to this code"></a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">  1</span><span class="c1"># Copyright (c) 2025, NVIDIA CORPORATION &amp; AFFILIATES. All rights reserved.</span>
<span class="linenos">  2</span><span class="c1">#</span>
<span class="linenos">  3</span><span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="linenos">  4</span><span class="c1"># you may not use this file except in compliance with the License.</span>
<span class="linenos">  5</span><span class="c1"># You may obtain a copy of the License at</span>
<span class="linenos">  6</span><span class="c1">#</span>
<span class="linenos">  7</span><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="linenos">  8</span><span class="c1">#</span>
<span class="linenos">  9</span><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
<span class="linenos"> 10</span><span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="linenos"> 11</span><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="linenos"> 12</span><span class="c1"># See the License for the specific language governing permissions and</span>
<span class="linenos"> 13</span><span class="c1"># limitations under the License.</span>
<span class="linenos"> 14</span>
<span class="linenos"> 15</span><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="linenos"> 16</span><span class="kn">import</span><span class="w"> </span><span class="nn">torch</span>
<span class="linenos"> 17</span><span class="kn">from</span><span class="w"> </span><span class="nn">accvlab.optim_test_tools</span><span class="w"> </span><span class="kn">import</span> <span class="n">NVTXRangeWrapper</span>
<span class="linenos"> 18</span>
<span class="hll"><span class="linenos"> 19</span><span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 20</span><span class="c1"># In this example, the individual sections (such as Main Script, Code Part I, Code Part II, etc.)</span>
</span><span class="hll"><span class="linenos"> 21</span><span class="c1"># indicate parts of the code which, in the actual use case, would be in different files, and would rely</span>
</span><span class="hll"><span class="linenos"> 22</span><span class="c1"># on the `NVTXRangeWrapper` being a singleton to enable its use throughout the files as shown here.</span>
</span><span class="linenos"> 23</span>
<span class="linenos"> 24</span>
<span class="linenos"> 25</span><span class="c1"># --------------------------- Main Script ---------------------------</span>
<span class="linenos"> 26</span>
<span class="linenos"> 27</span><span class="n">nvtx_wrp</span> <span class="o">=</span> <span class="n">NVTXRangeWrapper</span><span class="p">()</span>
<span class="hll"><span class="linenos"> 28</span><span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 29</span><span class="c1"># To activate the NVTX wrapper, it needs to be enabled.</span>
</span><span class="hll"><span class="linenos"> 30</span><span class="c1"># If the following step is omitted, pushing and popping ranges will have no effect.</span>
</span><span class="hll"><span class="linenos"> 31</span><span class="c1"># Try commenting out the following call to `enable()`.</span>
</span><span class="hll"><span class="linenos"> 32</span><span class="c1">#</span>
</span><span class="hll"><span class="linenos"> 33</span><span class="c1"># Also, note that the `keep_track_of_range_order` parameter should be set to `False` during actual profiling,</span>
</span><span class="hll"><span class="linenos"> 34</span><span class="c1"># as it has an overhead and should only be enabled for debugging purposes.</span>
</span><span class="linenos"> 35</span><span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">enable</span><span class="p">(</span>
<span class="linenos"> 36</span>    <span class="n">sync_on_push</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 37</span>    <span class="n">sync_on_pop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos"> 38</span>    <span class="n">keep_track_of_range_order</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Only set to `True` for debugging purposes (adds overhead)</span>
<span class="linenos"> 39</span><span class="p">)</span>
<span class="hll"><span class="linenos"> 40</span><span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 41</span><span class="c1"># Note that if the wrapper is not enabled, calling its methods has minimal overhead</span>
</span><span class="hll"><span class="linenos"> 42</span><span class="c1"># (call to an empty method).</span>
</span><span class="linenos"> 43</span>
<span class="linenos"> 44</span><span class="c1"># -------------------------------------------------------------------</span>
<span class="linenos"> 45</span>
<span class="linenos"> 46</span>
<span class="hll"><span class="linenos"> 47</span><span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 48</span><span class="c1"># If a code part (see below) is used in isolation (meaning that there is no other code which already</span>
</span><span class="hll"><span class="linenos"> 49</span><span class="c1"># enabled the NVTX wrapper), the wrapper will be disabled and any related calls will have no effect.</span>
</span><span class="hll"><span class="linenos"> 50</span><span class="c1"># The overhead for the wrapper is minimal in this case (call to an empty function).</span>
</span><span class="linenos"> 51</span>
<span class="linenos"> 52</span><span class="n">num_iters</span> <span class="o">=</span> <span class="mi">16</span>
<span class="linenos"> 53</span>
<span class="linenos"> 54</span><span class="c1"># &quot;Initialize&quot; the GPU</span>
<span class="linenos"> 55</span><span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>
<span class="linenos"> 56</span>
<span class="linenos"> 57</span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_iters</span><span class="p">):</span>
<span class="linenos"> 58</span>    <span class="c1"># --------------------------- Code Part I ---------------------------</span>
<span class="linenos"> 59</span>
<span class="hll"><span class="linenos"> 60</span>    <span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 61</span>    <span class="c1"># This will not create a new instance, but re-use the instance created above.</span>
</span><span class="linenos"> 62</span>    <span class="n">nvtx_wrp</span> <span class="o">=</span> <span class="n">NVTXRangeWrapper</span><span class="p">()</span>
<span class="linenos"> 63</span>    <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_push</span><span class="p">(</span><span class="s2">&quot;meas1&quot;</span><span class="p">)</span>
<span class="linenos"> 64</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
<span class="linenos"> 65</span>    <span class="c1"># ... continue and at some point call code part II</span>
<span class="linenos"> 66</span>
<span class="linenos"> 67</span>    <span class="c1"># -------------------------------------------------------------------</span>
<span class="linenos"> 68</span>
<span class="linenos"> 69</span>    <span class="c1"># --------------------------- Code Part II --------------------------</span>
<span class="linenos"> 70</span>
<span class="linenos"> 71</span>    <span class="n">nvtx_wrp</span> <span class="o">=</span> <span class="n">NVTXRangeWrapper</span><span class="p">()</span>
<span class="linenos"> 72</span>    <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_push</span><span class="p">(</span><span class="s2">&quot;meas2&quot;</span><span class="p">)</span>
<span class="linenos"> 73</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<span class="linenos"> 74</span>    <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_pop</span><span class="p">()</span>
<span class="hll"><span class="linenos"> 75</span>    <span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 76</span>    <span class="c1"># If the &quot;unexpected range&quot; range is pushed but not popped, then</span>
</span><span class="hll"><span class="linenos"> 77</span>    <span class="c1"># `nvtx_wrp.range_pop(&quot;meas1&quot;)` (see below) will trigger an error.</span>
</span><span class="hll"><span class="linenos"> 78</span>    <span class="c1"># Try uncommenting the &quot;unexpected range&quot; push below to see this.</span>
</span><span class="linenos"> 79</span>
<span class="linenos"> 80</span>    <span class="c1"># &gt;&gt; nvtx_wrp.range_push(&quot;unexpected range&quot;)</span>
<span class="linenos"> 81</span>
<span class="linenos"> 82</span>    <span class="c1"># ... continue and at some point call code part III</span>
<span class="linenos"> 83</span>
<span class="linenos"> 84</span>    <span class="c1"># -------------------------------------------------------------------</span>
<span class="linenos"> 85</span>
<span class="linenos"> 86</span>    <span class="c1"># -------------------------- Code Part III --------------------------</span>
<span class="linenos"> 87</span>
<span class="hll"><span class="linenos"> 88</span>    <span class="c1"># @NOTE</span>
</span><span class="hll"><span class="linenos"> 89</span>    <span class="c1"># Here we want to check whether the range that we are popping is the expected one.</span>
</span><span class="hll"><span class="linenos"> 90</span>    <span class="c1"># This can be done by specifying the expected range name when popping.</span>
</span><span class="hll"><span class="linenos"> 91</span>    <span class="c1"># This will trigger an error if we pushed an &quot;unexpected range&quot; in Code Part II.</span>
</span><span class="hll"><span class="linenos"> 92</span>    <span class="c1">#</span>
</span><span class="hll"><span class="linenos"> 93</span>    <span class="c1"># Note that keeping track of the range stack internallyadds overhead and should only be enabled for</span>
</span><span class="hll"><span class="linenos"> 94</span>    <span class="c1"># debugging purposes, not when actually performing the profiling (can be configured using the</span>
</span><span class="hll"><span class="linenos"> 95</span>    <span class="c1"># `keep_track_of_range_order` parameter when calling `enable()` for the wrapper). If you set this</span>
</span><span class="hll"><span class="linenos"> 96</span>    <span class="c1"># parameter to `False`, the mismatch check will be skipped (and no error will be raised even if the</span>
</span><span class="hll"><span class="linenos"> 97</span>    <span class="c1"># &quot;unexpected range&quot; is pushed).</span>
</span><span class="linenos"> 98</span>    <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_pop</span><span class="p">(</span><span class="s2">&quot;meas1&quot;</span><span class="p">)</span>
<span class="linenos"> 99</span>    <span class="c1"># ... continue and at some point call code part IV</span>
<span class="linenos">100</span>
<span class="linenos">101</span>    <span class="c1"># -------------------------------------------------------------------</span>
<span class="linenos">102</span>
<span class="linenos">103</span>    <span class="c1"># -------------------------- Code Part IV --------------------------</span>
<span class="linenos">104</span>
<span class="linenos">105</span>    <span class="n">nvtx_wrp</span> <span class="o">=</span> <span class="n">NVTXRangeWrapper</span><span class="p">()</span>
<span class="linenos">106</span>    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
<span class="linenos">107</span>        <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_push</span><span class="p">(</span><span class="s2">&quot;meas3&quot;</span><span class="p">)</span>
<span class="linenos">108</span>        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="linenos">109</span>        <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_pop</span><span class="p">()</span>
<span class="linenos">110</span>    <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_push</span><span class="p">(</span><span class="s2">&quot;meas2&quot;</span><span class="p">)</span>
<span class="linenos">111</span>    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
<span class="linenos">112</span>    <span class="n">nvtx_wrp</span><span class="o">.</span><span class="n">range_pop</span><span class="p">()</span>
<span class="linenos">113</span>
<span class="linenos">114</span>    <span class="c1"># -------------------------------------------------------------------</span>
<span class="linenos">115</span>
<span class="linenos">116</span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Script ran without errors&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="related-examples">
<h2>Related examples<a class="headerlink" href="#related-examples" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>See the <a class="reference internal" href="stopwatch.html"><span class="doc">Stopwatch Example</span></a> example for similar usage with timings and warm-up handling.</p></li>
<li><p>The tensor dumper examples (<a class="reference internal" href="tensor_dumper_comparison.html"><span class="doc">Tensor Dumper – Comparison Example</span></a> and <a class="reference internal" href="tensor_dumper_dumping.html"><span class="doc">Tensor Dumper – Extended Dumping Example</span></a>) demonstrate
another singleton tool for capturing tensors and gradients.</p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="stopwatch.html" class="btn btn-neutral float-left" title="Stopwatch Example" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="tensor_dumper_comparison.html" class="btn btn-neutral float-right" title="Tensor Dumper – Comparison Example" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, NVIDIA Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>